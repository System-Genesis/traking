# טראקינג

## מערכת לסינכרון נתונים לקרטופל

### המערכת מקבלת נתונים ממספר מקורות (כל מקור והסיבוכיות שלו) מאחדת אותם תחת ישות אחד ומעדכנת את קרטופל בשינויים

#### סרביסים:

- TASK-MANAGER :

        נקודת הכניסה לטראקינג (סוג של פרוקסי / GATE) כל פעולה שטראקינג מאפשר עוברת מכאן.

- SPLITTER :

        היחיד שניגש למקורות המידע (PNCY - מביא לנו מידע על USERS ממקורות שונים במרחב)
        לוקח מידע מהמקורות מפצל אותם ליחידים ומעביר אותם לטיפול המערכת (קיימת גם האופציה להעביר את כל המידע לא כמערך אם
        רוצים לקבל את כל המידע) – שולח הלאה ל BASIC MATCH.

- PNCY :

        מפוצל לכמה סרביסים, כל סרביס אחראי להביא מידע ממקור אחר – מייצאים רק פעולות GET.

- BASIC MATCH :

        הופך כל אובייקט ממקור מידע לאובייקט קבוע שמתאים לקרטופל, 
        אחראי על וולידציות של שדות בודדים וסינון שדות – מעביר הלאה רק שדות תקינים ושדות שאנחנו
        רוצים לקחת – שולח הלאה ל MERGER.

- MERGER :

        מאגד את כל האובייקטים מכל מקורות המידע של אדם אחד ל document אחד ב Mongodb (יודע לאגד לפי מזהים – מספר אישי, תעודת זהות, GoalUserId). 
        בנוסף מעדכן את את האובייקט כאשר מזהה שינוי.
        במידה ויש עדכון או שנוסף אובייקט לאדם הוא מעביר את האובייקט הלאה לשאר ה FLOW של קארטינג – הלאה ל SELECTOR. מטרת הסרביס
        היא גם לאחד אובייקטים של אותו אדם תחת אובייקט אחד, וגם מניעת פעולות הסנכרון כאשר ידוע שאין שינוי ביחס למה שכבר יש לנו מימים קודמים.

- MERGER API:

        הוא API ל DB של ה MERGER. מייחצן שתי פעולות: GET – קבלת המידע, POST – שליחת ה documents להמשך קרטינג(הפעלת סנכרון עליהם)  - 
        שולח ל SELECTOR. 
        מקבל את הבקשות מהTASK MANAGER

- BLACK LIST / DELETE:

        אחראי על ניהול מחיקות:
        מוחק מידע ישן בmerger ושולח לselector שמישהו נמחק לו מידע שיבנה entity מחדש לפי המידע שנשאר,
        ושולח לcreate מזהה של הdi שנמחק כדי שיטפל במחיקה בקרטופל.

- SELECTOR :

        בודק האם האובייקט המלא של הבן אדם (עם כל המקורות שנתנו מידע עליו) תקין בשביל קרטופל (ולידציה של כל האובייקט ולא שדות בודדים למשל: אזרח חייב ת.ז.)
        ומעביר לBUILD המתאים או לשניהם. חשוב: כל בדיקה שתיהיה בקרטופל חייבת להיבדק גם כאן (אחרת היווצרו דברים שלא שלמים למשל di ללא אדם לקשר אליו)

- BUILD ENTITY :

        בונה ENTITY תקין לקרטופל.
        לוקח מכול מקור את השדות לפי סדר ההיררכיה של המקורות למשל מידע AKAאי ילקח קודם מaka ואז יושלם ממקורות אחרים.
        לבסוף מסנן שדות תקינים אך לא אמורים לעבור.

- BUILD RODG :

        מקבל מידע ממקוד בודד ובונה ממנו : יוזר(di), קבוצה(group) ותפקיד(role) תקינים לקרטופל.
        יוצר אוביקט  שיכול להכיל את שלושת האובייקטים תלוי בכמות המידע שקיבלנו.
        תמיד יוווצר יוזר במידה ואין תפקיד ליצור לא תווצר קבוצה.

- MIRROR :

        מדמה את טבלת האנשים כמו שקרטינג רואה את קרטופל,
        מכיוון שיכולים להיות עוד שרותים שמעדכנים את קרטופל אי אפשר לשוות את האוביקט שלנו למה שקיים בקרטופל כי יכול להיות ששינוי הוא לא בגלל עידכון מצד
        טראקינג אלא ממקור אחר, ולכן יש לנו את MIRROR ששומר את המידע איך שטראקינג עידכן ורק אם יהיה שינוי ביחס לזה ישלח עידכון לקרטופל.
        ההשוואה שcreate עושה באנשים היא מול mirror ולא מול קרטופל

- CREATE RGBE:

        היחיד שמדבר בפועל עם קרטופל.
        שולח את כל המידע הסופי לקרטופל. בודק האם המידע חדש או רק צריך לעדכן משהו קיים.
        מנתק ומחבר במקרה של מעבר . מוחק במקרה שמקבל הוראת מחיקה.

        Entity: יוצר או מעדכן.
        Di: יוצר או מעדכן ודואג לחיבור לentity לפעמים צריך לנתק מאחר, לפעמים צריך למחוק קיים ואז ליצור ולחבר.
        Group: יוצר את הקבוצה עם כל הקבוצות שמעליה אם צריך
        Role: יוצר או מעדכן. מחבר לdi ומחבר לgroup או מנתק ומחבר
